---
import { shortendURLTable, eq, db } from "astro:db";
const { params, redirect } = Astro;
const { url_id } = params;

// Verificar si la url ya existe en la base de datos
const shortenedURL = await db
  .select()
  .from(shortendURLTable)
  .where(eq(shortendURLTable.hash_url, url_id));

if (shortenedURL.length === 0) {
  return redirect("/");
}

// Redireccionar a la url original ðŸ’€
const newURL = new URL(shortenedURL[0].url);
return redirect(newURL?.origin, 301);
---